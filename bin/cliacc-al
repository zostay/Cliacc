#!/usr/bin/env perl
use v5.14;

use FindBin;
use lib "$FindBin::Bin/../lib";
use Cliacc::DB;
use Cliacc::Service::Account;
use Cliacc::Service::Ledger;

use Getopt::Long;

my $name;

GetOptions(
    'n|name=s' => \$name,
);

die "Please set --name." unless $name;

my $db = Cliacc::DB->new( root => "$FindBin::Bin/.." );
my $accounts = Cliacc::Service::Account->new( db => $db );
my $ledgers  = Cliacc::Service::Ledger->new( db => $db );

my $account = $accounts->get_account_by_name($name);
$accounts->get_account_balance($account);

my @lines = $ledgers->list_ledger_lines_by_account($account);

for my $line (@lines) {
    printf "%-03d %-3s %-20s %-10s %8.2f\n",
        $line->line, $line->reference_number // '-',
        $line->description, $line->transfer_name, $line->amount;
} 

print ' ' x 40;
printf "%8.2f\n", $account->balance_amount;
